<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-transactions-and-encryption/csfle" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">CSFLE | MongoDB Sprout: Where Data Meets Spring</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://mongodb-sprout-workshop.github.io/mongodb-sprout-workshop/docs/transactions-and-encryption/csfle"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="CSFLE | MongoDB Sprout: Where Data Meets Spring"><meta data-rh="true" name="description" content="This section explores the integration of MongoDB&#x27;s Client-Side Field Level Encryption (CSFLE) with Spring Data MongoDB,"><meta data-rh="true" property="og:description" content="This section explores the integration of MongoDB&#x27;s Client-Side Field Level Encryption (CSFLE) with Spring Data MongoDB,"><link data-rh="true" rel="icon" href="/mongodb-sprout-workshop/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://mongodb-sprout-workshop.github.io/mongodb-sprout-workshop/docs/transactions-and-encryption/csfle"><link data-rh="true" rel="alternate" href="https://mongodb-sprout-workshop.github.io/mongodb-sprout-workshop/docs/transactions-and-encryption/csfle" hreflang="en"><link data-rh="true" rel="alternate" href="https://mongodb-sprout-workshop.github.io/mongodb-sprout-workshop/docs/transactions-and-encryption/csfle" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-ZJ28V71VTQ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-ZJ28V71VTQ",{anonymize_ip:!0})</script><link rel="stylesheet" href="/mongodb-sprout-workshop/assets/css/styles.23ebc008.css">
<script src="/mongodb-sprout-workshop/assets/js/runtime~main.e19aa576.js" defer="defer"></script>
<script src="/mongodb-sprout-workshop/assets/js/main.9f21ebf4.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const a=new URLSearchParams(window.location.search).entries();for(var[t,e]of a)if(t.startsWith("docusaurus-data-")){var n=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(n,e)}}catch(t){}}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:#fafbfc;color:#091E42" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">We are looking to revamp our docs, please fill <a target="_blank" rel="noopener noreferrer" href="#">this survey</a></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/mongodb-sprout-workshop/"><div class="navbar__logo"><img src="/mongodb-sprout-workshop/img/logo.svg" alt="MongoDB Logo" class="navbar-logo themedComponent_mlkZ themedComponent--light_NVdE" height="100%" width="135px"><img src="/mongodb-sprout-workshop/img/logo-dark.svg" alt="MongoDB Logo" class="navbar-logo themedComponent_mlkZ themedComponent--dark_xIcU" height="100%" width="135px"></div><b class="navbar__title text--truncate">MongoDB Sprout: Where Data Meets Spring</b></a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG menuWithAnnouncementBar_GW3s"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mongodb-sprout-workshop/docs/intro">üìò Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mongodb-sprout-workshop/docs/what-is-mongodb">What is MongoDB</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mongodb-sprout-workshop/docs/quick-start">üèÅ Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/mongodb-sprout-workshop/docs/category/spring-data-mongodb">Spring Data MongoDB</a><button aria-label="Expand sidebar category &#x27;Spring Data MongoDB&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/mongodb-sprout-workshop/docs/category/repositories-and-aggregation">üí°Repositories and Aggregation</a><button aria-label="Expand sidebar category &#x27;üí°Repositories and Aggregation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/mongodb-sprout-workshop/docs/category/transactions-and-encrytion">Transactions and Encrytion</a><button aria-label="Collapse sidebar category &#x27;Transactions and Encrytion&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mongodb-sprout-workshop/docs/transactions-and-encryption/transactions">Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mongodb-sprout-workshop/docs/transactions-and-encryption/csfle">CSFLE</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mongodb-sprout-workshop/docs/summary">üéØ Summary</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mongodb-sprout-workshop/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/mongodb-sprout-workshop/docs/category/transactions-and-encrytion"><span itemprop="name">Transactions and Encrytion</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">CSFLE</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CSFLE</h1>
<p>This section explores the integration of MongoDB&#x27;s Client-Side Field Level Encryption (CSFLE) with Spring Data MongoDB,
focusing on securing data directly from the client side before it is stored in the database. This approach is crucial
for compliance with data privacy laws and regulations.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How it Works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How it Works" title="Direct link to How it Works">‚Äã</a></h2>
<p>CSFLE encrypts sensitive data before it reaches the MongoDB cluster, making the data remain secure during transit
and at rest. The process involves generating a master key, creating Data Encryption Keys (DEK), encrypting specific
fields in your documents, and securely managing the keys.</p>
<p><img decoding="async" loading="lazy" alt="Architecture for CSLFE" src="/mongodb-sprout-workshop/assets/images/csfle-diagram-3e923870493c8468f3a9b2811604389a.jpg" width="969" height="685" class="img_ev3q"></p>
<p>While you can use MongoDB as your key vault, you can use other providers.</p>
<p>Key Concepts</p>
<ul>
<li><strong>Encryption</strong>: CSFLE encrypts sensitive data before it reaches the MongoDB cluster, ensuring that the
data remains secure during transit and at rest.</li>
<li><strong>Master Key</strong>: A master key is used to encrypt Data Encryption Keys (DEK). The master key must be securely
managed and protected.</li>
<li><strong>Data Encryption Keys (DEK)</strong>: DEKs are used to encrypt individual fields within the MongoDB documents.
DEKs themselves are encrypted using the master key.</li>
<li><strong>Manual and Automatic Encryption</strong>: CSFLE supports both manual and automatic encryption. In this workshop,
we will use manual encryption which does not require MongoDB Enterprise or Atlas.</li>
</ul>
<p>CSFLE is an excellent tool for ensuring compliance with data protection regulations such as GDPR.
It provides a method to securely encrypt and manage sensitive data fields, allowing for easy implementation
of &quot;right-to-be-forgotten&quot; policies by simply deleting the corresponding DEKs. This ensures that data
cannot be restored from backups or logs once the key is deleted, making it a powerful feature for data
privacy and security.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-master-key">The Master Key<a href="#the-master-key" class="hash-link" aria-label="Direct link to The Master Key" title="Direct link to The Master Key">‚Äã</a></h2>
<p>A master key is necessary to encrypt and decrypt Data Encryption Keys (DEK).
Here‚Äôs how you can generate and store a master key locally:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.FileInputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.FileOutputStream;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.io.IOException;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.security.SecureRandom;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Arrays;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MasterKey {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final int SIZE_MASTER_KEY = 96;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static final String MASTER_KEY_FILENAME = &quot;master_key.txt&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new MasterKey().tutorial();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void tutorial() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        final byte[] masterKey = generateNewOrRetrieveMasterKeyFromFile(MASTER_KEY_FILENAME);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;Master Key: &quot; + Arrays.toString(masterKey));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private byte[] generateNewOrRetrieveMasterKeyFromFile(String filename) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] masterKey = new byte[SIZE_MASTER_KEY];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            retrieveMasterKeyFromFile(filename, masterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;An existing Master Key was found in file \&quot;&quot; + filename + &quot;\&quot;.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            masterKey = generateMasterKey();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            saveMasterKeyToFile(filename, masterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;A new Master Key has been generated and saved to file \&quot;&quot; + filename + &quot;\&quot;.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return masterKey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void retrieveMasterKeyFromFile(String filename, byte[] masterKey) throws IOException {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try (FileInputStream fis = new FileInputStream(filename)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fis.read(masterKey, 0, SIZE_MASTER_KEY);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private byte[] generateMasterKey() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] masterKey = new byte[SIZE_MASTER_KEY];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        new SecureRandom().nextBytes(masterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return masterKey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private void saveMasterKeyToFile(String filename, byte[] masterKey) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try (FileOutputStream fos = new FileOutputStream(filename)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fos.write(masterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code generates a 96-byte master key using a secure random number generator and stores it in a local file named <code>master_key.txt</code>.
If the file already exists, it reads the key from the file.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-key-management-service-kms-provider">The Key Management Service (KMS) Provider<a href="#the-key-management-service-kms-provider" class="hash-link" aria-label="Direct link to The Key Management Service (KMS) Provider" title="Direct link to The Key Management Service (KMS) Provider">‚Äã</a></h2>
<p>Set up the key management service (KMS) provider to use the master key for creating and managing DEKs.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.HashMap;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import java.util.Map;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class KeyManagementService {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Map&lt;String, Map&lt;String, Object&gt;&gt; getKmsProviders(byte[] localMasterKey) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Map&lt;String, Object&gt;&gt; kmsProviders = new HashMap&lt;&gt;();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        kmsProviders.put(&quot;local&quot;, new HashMap&lt;&gt;() {{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            put(&quot;key&quot;, localMasterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }});</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return kmsProviders;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code sets up a local KMS provider using the master key. The KMS provider will be used to create and manage DEKs.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-clients">The Clients<a href="#the-clients" class="hash-link" aria-label="Direct link to The Clients" title="Direct link to The Clients">‚Äã</a></h2>
<p>Set up two different clients:</p>
<ul>
<li><strong>ClientEncryption</strong>: Used to create Data Encryption Keys (DEK) and encrypt fields manually.</li>
<li><strong>MongoClient</strong>: A conventional MongoDB connection used to read and write documents, configured to
automatically decrypt the encrypted fields.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="clientencryption">ClientEncryption<a href="#clientencryption" class="hash-link" aria-label="Direct link to ClientEncryption" title="Direct link to ClientEncryption">‚Äã</a></h3>
<p>This code creates a <code>ClientEncryption</code> instance using the KMS provider and key vault namespace.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.*;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.vault.ClientEncryption;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.vault.ClientEncryptions;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.model.vault.ClientEncryptionSettings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class EncryptionClient {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static ClientEncryption getClientEncryption(Map&lt;String, Map&lt;String, Object&gt;&gt; kmsProviders) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ClientEncryptionSettings ces = ClientEncryptionSettings.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .keyVaultMongoClientSettings(MongoClientSettings.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .applyConnectionString(new ConnectionString(&quot;mongodb://localhost&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                        .build())</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .keyVaultNamespace(&quot;csfle.vault&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .kmsProviders(kmsProviders)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return ClientEncryptions.create(ces);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mongoclient">MongoClient<a href="#mongoclient" class="hash-link" aria-label="Direct link to MongoClient" title="Direct link to MongoClient">‚Äã</a></h3>
<p>This code creates a <code>MongoClient</code> instance configured with auto-encryption settings to automatically decrypt encrypted fields.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.MongoClientSettings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.MongoClients;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.MongoClient;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.model.vault.AutoEncryptionSettings;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class MongoDBClient {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static MongoClient getMongoClient(Map&lt;String, Map&lt;String, Object&gt;&gt; kmsProviders) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        AutoEncryptionSettings aes = AutoEncryptionSettings.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .keyVaultNamespace(&quot;csfle.vault&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .kmsProviders(kmsProviders)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .bypassAutoEncryption(true)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MongoClientSettings mcs = MongoClientSettings.builder()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .applyConnectionString(new ConnectionString(&quot;mongodb://localhost&quot;))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .autoEncryptionSettings(aes)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .build();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return MongoClients.create(mcs);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="unique-index-on-key-alternate-names">Unique Index on Key Alternate Names<a href="#unique-index-on-key-alternate-names" class="hash-link" aria-label="Direct link to Unique Index on Key Alternate Names" title="Direct link to Unique Index on Key Alternate Names">‚Äã</a></h2>
<p>Before creating your first Data Encryption Key (DEK), create a unique index on the
key alternate names to ensure that each key has a unique name.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.MongoCollection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.Document;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class IndexManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void createUniqueIndex(MongoCollection&lt;Document&gt; vaultCollection) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vaultCollection.createIndex(ascending(&quot;keyAltNames&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                new IndexOptions().unique(true).partialFilterExpression(exists(&quot;keyAltNames&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This code creates a unique index on the <code>keyAltNames</code> field in the key vault collection
to ensure that each DEK has a unique name.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-data-encryption-keys">Create Data Encryption Keys<a href="#create-data-encryption-keys" class="hash-link" aria-label="Direct link to Create Data Encryption Keys" title="Direct link to Create Data Encryption Keys">‚Äã</a></h2>
<p>Create Data Encryption Keys (DEK) for encrypting specific fields in your documents.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.BsonBinary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.vault.ClientEncryption;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DataEncryptionKeyManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static BsonBinary createDataEncryptionKey(ClientEncryption encryption, String keyAltName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return encryption.createDataKey(&quot;local&quot;, new DataKeyOptions().keyAltNames(List.of(keyAltName)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This creates a DEK with a specified alternate name using the ClientEncryption instance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="create-and-insert-encrypted-documents-using-the-deks">Create and insert encrypted documents using the DEKs.<a href="#create-and-insert-encrypted-documents-using-the-deks" class="hash-link" aria-label="Direct link to Create and insert encrypted documents using the DEKs." title="Direct link to Create and insert encrypted documents using the DEKs.">‚Äã</a></h2>
<p>This snippet creates a document with encrypted fields and inserts it into the specified MongoDB collection. It is paraphrased from
the repo we provided you:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.BsonBinary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.BsonString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.Document;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.MongoCollection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.vault.ClientEncryption;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class DocumentManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Document createEncryptedDocument(ClientEncryption encryption, String name, int age, String phone, String bloodType, BsonBinary keyId) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BsonBinary encryptedPhone = encryption.encrypt(new BsonString(phone), new EncryptOptions(&quot;AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic&quot;).keyId(keyId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BsonBinary encryptedBloodType = encryption.encrypt(new BsonString(bloodType), new EncryptOptions(&quot;AEAD_AES_256_CBC_HMAC_SHA_512-Random&quot;).keyId(keyId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return new Document(&quot;name&quot;, name)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .append(&quot;age&quot;, age)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .append(&quot;phone&quot;, encryptedPhone)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                .append(&quot;blood_type&quot;, encryptedBloodType);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void insertDocuments(MongoCollection&lt;Document&gt; collection, Document... documents) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        collection.insertMany(Arrays.asList(documents));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Here is what Bobby and Alice documents look like in my <code>encrypted.users</code> collection:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="bobby">Bobby<a href="#bobby" class="hash-link" aria-label="Direct link to Bobby" title="Direct link to Bobby">‚Äã</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;_id&quot; : ObjectId(&quot;6054d91c26a275034fe53300&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot; : &quot;Bobby&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;age&quot; : 33,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;phone&quot; : BinData(6,&quot;ATKkRdZWR0+HpqNyYA7zgIUCgeBE4SvLRwaXz/rFl8NPZsirWdHRE51pPa/2W9xgZ13lnHd56J1PLu9uv/hSkBgajE+MJLwQvJUkXatOJGbZd56BizxyKKTH+iy+8vV7CmY=&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;blood_type&quot; : BinData(6,&quot;AjKkRdZWR0+HpqNyYA7zgIUCUdc30A8lTi2i1pWn7CRpz60yrDps7A8gUJhJdj+BEqIIx9xSUQ7xpnc/6ri2/+ostFtxIq/b6IQArGi+8ZBISw==&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;medical_record&quot; : BinData(6,&quot;AjKkRdZWR0+HpqNyYA7zgIUESl5s4tPPvzqwe788XF8o91+JNqOUgo5kiZDKZ8qudloPutr6S5cE8iHAJ0AsbZDYq7XCqbqiXvjQobObvslR90xJvVMQidHzWtqWMlzig6ejdZQswz2/WT78RrON8awO&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="alice">Alice<a href="#alice" class="hash-link" aria-label="Direct link to Alice" title="Direct link to Alice">‚Äã</a></h3>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;_id&quot; : ObjectId(&quot;6054d91c26a275034fe53301&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot; : &quot;Alice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;age&quot; : 28,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;phone&quot; : BinData(6,&quot;AX7Xd65LHUcWgYj+KbUT++sCC6xaCZ1zaMtzabawAgB79quwKvld8fpA+0m+CtGevGyIgVRjtj2jAHAOvREsoy3oq9p5mbJvnBqi8NttHUJpqooUn22Wx7o+nlo633QO8+c=&quot;),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;blood_type&quot; : BinData(6,&quot;An7Xd65LHUcWgYj+KbUT++sCTyp+PJXudAKM5HcdX21vB0VBHqEXYSplHdZR0sCOxzBMPanVsTRrOSdAK5yHThP3Vitsu9jlbNo+lz5f3L7KYQ==&quot;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Client Side Field Level Encryption currently provides
two different algorithms to encrypt the data you want to secure.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="deterministic-aead_aes_256_cbc_hmac_sha_512-deterministic">Deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic<a href="#deterministic-aead_aes_256_cbc_hmac_sha_512-deterministic" class="hash-link" aria-label="Direct link to Deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic" title="Direct link to Deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic">‚Äã</a></h3>
<p>With this algorithm, the result of the encryption ‚îÄ given the same inputs (value and DEK) ‚îÄ is
deterministic. This means that we have a greater support for read operations, but encrypted data with low
cardinality is susceptible to frequency analysis attacks, where bad actors can continually monitor encrypted data to reverse-engineer the
encryption.
If I want to be able to retrieve users by phone numbers, I must use the deterministic algorithm. As a phone number is likely
to be unique in my collection of users, it&#x27;s safe to use this algorithm here.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="non-deterministic-aead_aes_256_cbc_hmac_sha_512-random">Non-deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Random<a href="#non-deterministic-aead_aes_256_cbc_hmac_sha_512-random" class="hash-link" aria-label="Direct link to Non-deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Random" title="Direct link to Non-deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Random">‚Äã</a></h3>
<p>With this algorithm, the result of the encryption is always different. It provides the strongest guarantees of data
confidentiality, even when the cardinality is low, but prevents read operations based on these fields.
In my example, the blood type has a low cardinality and it doesn&#x27;t make sense to search in my user collection by blood type anyway, so it&#x27;s
safe to use this algorithm for this field.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="querying-encrypted-documents">Querying Encrypted Documents<a href="#querying-encrypted-documents" class="hash-link" aria-label="Direct link to Querying Encrypted Documents" title="Direct link to Querying Encrypted Documents">‚Äã</a></h2>
<p>To query encrypted fields, you need to encrypt the query field using the same DEK.
To read Bobby&#x27;s Document:</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.BsonBinary;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.BsonString;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.MongoCollection;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import com.mongodb.client.vault.ClientEncryption;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import org.bson.Document;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">public class QueryManager {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static Document findEncryptedDocumentByPhone(ClientEncryption encryption, MongoCollection&lt;Document&gt; collection, String phone, String keyAltName) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        BsonBinary encryptedPhone = encryption.encrypt(new BsonString(phone), new EncryptOptions(&quot;AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic&quot;).keyAltName(keyAltName));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return collection.find(eq(&quot;phone&quot;, encryptedPhone)).first();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This encrypts the phone number using the DEK associated with Bobby and uses this encrypted
value to query the users collection for Bobby&#x27;s document. The result is then printed out.</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;_id&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &quot;$oid&quot;: &quot;6054d91c26a275034fe53300&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  },</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;name&quot;: &quot;Bobby&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;age&quot;: 33,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;phone&quot;: &quot;01 23 45 67 89&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;blood_type&quot;: &quot;A+&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;medical_record&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;test&quot;: &quot;heart&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      &quot;result&quot;: &quot;bad&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="removing-dek-and-querying-document">Removing DEK and Querying Document<a href="#removing-dek-and-querying-document" class="hash-link" aria-label="Direct link to Removing DEK and Querying Document" title="Direct link to Removing DEK and Querying Document">‚Äã</a></h2>
<p>To remove Alice&#x27;s Document and verify that removing a DEK makes the associated encrypted data irretrievable.</p>
<div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">public class KeyRemovalTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] localMasterKey = getMasterKey(&quot;master_key.txt&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, Map&lt;String, Object&gt;&gt; kmsProviders = KeyManagementService.getKmsProviders(localMasterKey);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MongoClient mongoClient = MongoDBClient.getMongoClient(kmsProviders);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MongoCollection&lt;Document&gt; vaultCollection = mongoClient.getDatabase(&quot;csfle&quot;).getCollection(&quot;vault&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Remove Alice&#x27;s DEK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        vaultCollection.deleteOne(eq(&quot;keyAltNames&quot;, &quot;Alice&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Attempt to read Alice&#x27;s document</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        MongoCollection&lt;Document&gt; usersCollection = mongoClient.getDatabase(&quot;test&quot;).getCollection(&quot;users&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Document aliceDoc = usersCollection.find(eq(&quot;name&quot;, &quot;Alice&quot;)).first();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        if (aliceDoc != null) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;Alice&#x27;s document: &quot; + aliceDoc.toJson());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } else {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println(&quot;Alice&#x27;s document not found.&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    private static byte[] getMasterKey(String filename) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        byte[] masterKey = new byte[96];</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        try (FileInputStream fis = new FileInputStream(filename)) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            fis.read(masterKey, 0, 96);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            throw new RuntimeException(&quot;Failed to read master key from file&quot;, e);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        return masterKey;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This deletes Alice&#x27;s DEK from the key vault collection and attempts to read Alice&#x27;s document
from the users collection. Without the DEK, the encrypted fields in Alice&#x27;s document cannot be decrypted,
demonstrating the security of CSFLE.</p>
<p>If I try to read it immediately after deleting her document, there is a great chance that I will still able to do so because of the
<a href="https://github.com/mongodb/specifications/blob/master/source/client-side-encryption/client-side-encryption.md" target="_blank" rel="noopener noreferrer">60 seconds Data Encryption Key Cache</a> that is managed by <code>libmongocrypt</code>.
This cache is important because, without it, multiple back-and-forth would be necessary to decrypt the
document. It&#x27;s critical to prevent CSFLE from killing the performances of your MongoDB cluster.</p>
<p>To see all this in action, run the <code>ClientSideFieldLevelEncryption</code> class:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn spring-boot:run -Dspring-boot.run.arguments=&quot;csfle&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/mongodb-developer/mongodb-sprout-workshop/blob/main/docs/06-transactions-and-encryption/2-csfle.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/mongodb-sprout-workshop/docs/transactions-and-encryption/transactions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Transactions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mongodb-sprout-workshop/docs/summary"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">üéØ Summary</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How it Works</a></li><li><a href="#the-master-key" class="table-of-contents__link toc-highlight">The Master Key</a></li><li><a href="#the-key-management-service-kms-provider" class="table-of-contents__link toc-highlight">The Key Management Service (KMS) Provider</a></li><li><a href="#the-clients" class="table-of-contents__link toc-highlight">The Clients</a><ul><li><a href="#clientencryption" class="table-of-contents__link toc-highlight">ClientEncryption</a></li><li><a href="#mongoclient" class="table-of-contents__link toc-highlight">MongoClient</a></li></ul></li><li><a href="#unique-index-on-key-alternate-names" class="table-of-contents__link toc-highlight">Unique Index on Key Alternate Names</a></li><li><a href="#create-data-encryption-keys" class="table-of-contents__link toc-highlight">Create Data Encryption Keys</a></li><li><a href="#create-and-insert-encrypted-documents-using-the-deks" class="table-of-contents__link toc-highlight">Create and insert encrypted documents using the DEKs.</a><ul><li><a href="#bobby" class="table-of-contents__link toc-highlight">Bobby</a></li><li><a href="#alice" class="table-of-contents__link toc-highlight">Alice</a></li><li><a href="#deterministic-aead_aes_256_cbc_hmac_sha_512-deterministic" class="table-of-contents__link toc-highlight">Deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Deterministic</a></li><li><a href="#non-deterministic-aead_aes_256_cbc_hmac_sha_512-random" class="table-of-contents__link toc-highlight">Non-deterministic: AEAD_AES_256_CBC_HMAC_SHA_512-Random</a></li></ul></li><li><a href="#querying-encrypted-documents" class="table-of-contents__link toc-highlight">Querying Encrypted Documents</a></li><li><a href="#removing-dek-and-querying-document" class="table-of-contents__link toc-highlight">Removing DEK and Querying Document</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__links text--center"><div class="footer__links"><a href="https://www.mongodb.com/try?utm_campaign=devrel&amp;utm_source=workshop&amp;utm_medium=cta&amp;utm_content=mongodb_sprout_workshop&amp;utm_term=tim.kelly" target="_blank" rel="noopener noreferrer" class="footer__link-item">Try MongoDB Atlas<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">¬∑</span><a href="https://www.mongodb.com/community/forums/utm_campaign=devrel&amp;utm_source=workshop&amp;utm_medium=cta&amp;utm_content=mongodb_sprout_workshop&amp;utm_term=tim.kelly" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">¬∑</span><a href="https://www.mongodb.com/developer/utm_campaign=devrel&amp;utm_source=workshop&amp;utm_medium=cta&amp;utm_content=mongodb_sprout_workshop&amp;utm_term=tim.kelly" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Center<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">¬∑</span><a href="https://learn.mongodb.com/utm_campaign=devrel&amp;utm_source=workshop&amp;utm_medium=cta&amp;utm_content=mongodb_sprout_workshop&amp;utm_term=tim.kelly" target="_blank" rel="noopener noreferrer" class="footer__link-item">MongoDB University<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">¬∑</span><a href="https://github.com/mongodb-developer/mongodb-sprout-workshop" target="_blank" rel="noopener noreferrer" class="footer__link-item">This lab in GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><span class="footer__link-separator">¬∑</span><a href="#" class="footer__link-item">¬© 2024 MongoDB, Inc.</a></div></div></div></footer></div>
</body>
</html>